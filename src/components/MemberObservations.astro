---
import { getCollection } from 'astro:content';
import ObservationCard from './ObservationCard.astro';

// Get latest observations
const observations = await getCollection('observations');
const latestObservations = observations
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 3);
---

<div class="card-header">
  <img src={`${import.meta.env.BASE_URL || '/'}images/navigation/icons/icon_diaries.png`} alt="Member Observations" class="section-icon" />
  <h2 class="text-2xl font-medium text-cream m-0">Member Observations</h2>
</div>

<div class="card-content">
  <p class="text-sepia italic mb-md">Latest discoveries and experiments from our botanical brotherhood</p>
  
  <div class="space-y-md">
    {latestObservations.map((observation) => (
      <ObservationCard observation={observation} size="compact" />
    ))}
  </div>

  {observations.length === 0 && (
    <div class="text-center py-lg">
      <p class="text-sepia italic">No observations have been recorded yet. The mysteries await documentation...</p>
    </div>
  )}

  {observations.length > 3 && (
    <div class="text-center mt-md">
      <a 
        href={`${import.meta.env.BASE_URL || '/'}observations/`}
        class="inline-flex items-center text-moss hover:text-forest-shadow transition-colors font-medium"
      >
        View All Member Observations
        <svg class="ml-1 w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
        </svg>
      </a>
    </div>
  )}
</div>

